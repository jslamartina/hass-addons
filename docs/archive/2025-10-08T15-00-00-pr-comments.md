# PR Inline Comments for High-Severity Issues

## Instructions

Once the PR is created at:
<https://github.com/jslamartina/hass-addons/pull/new/baseline-review/2025-10-08>

Add the following inline comments to the respective files:

---

## üî¥ SEC-1: Hardcoded Credentials

### File: `cync-controller/config.yaml` (Line 39)

#### Comment

```text
üî¥ **CRITICAL SECURITY ISSUE**: Hardcoded Personal Email Address

This configuration file contains a hardcoded personal email address that should not be committed to version control.

**Risk:** Personal information exposure, potential privacy violation

#### Fix Required:
- Remove this default value
- Set to `null` or provide placeholder
- Document credential setup in DOCS.md
- Rotate this credential immediately if it's been exposed

#### Example Fix:
```text

options:
account_username: null # User must configure via add-on UI

```text

**Effort:** 15 minutes

```text

---

### File: `cync-controller/config.yaml` (Lines 44-45)

#### Comment

```text

üî¥ **CRITICAL SECURITY ISSUE**: Weak Default MQTT Credentials

Default credentials "dev"/"dev" are extremely weak and pose a security risk.

### Risk:

- Unauthorized MQTT access
- Device control by attackers
- Data interception

### Fix Required:

- Remove default credentials
- Force users to set strong passwords
- Add validation for password strength
- Document secure credential practices

### Example Fix:

```text

mqtt_user: null # Required - no defaults
mqtt_pass: null # Required - must be strong password

```markdown
**Effort:** 30 minutes
```text

---

### File: `cync-controller/config.yaml.backup`

#### Comment

```bash

üî¥ **CRITICAL SECURITY ISSUE**: Sensitive Backup File Committed to Git

This backup file contains the same credentials as the main config and should NEVER be in version control.

### Risk:

- Credential exposure in git history (permanent)
- Cannot be fully removed without rewriting history
- Violates security best practices

### Fix Required (IMMEDIATE):

```text

## Remove from repository

git rm cync-controller/config.yaml.backup

## Prevent future backups

echo "\*.backup" >> .gitignore
echo "config.yaml.backup" >> .gitignore

## Commit changes

git commit -m "Remove sensitive backup file and update gitignore"

```bash
**NOTE:** This file will remain in git history. Consider it permanently exposed.

**Effort:** 15 minutes
```text

---

### File: `cync-controller/Dockerfile` (Lines 38-39)

#### Comment

```sql

üî¥ **CRITICAL SECURITY ISSUE**: Hardcoded Credentials in Docker Image

Environment variables contain hardcoded email and empty password defaults.

### Risk

- Credentials baked into container images
- Pushed to container registries (public exposure risk)
- Difficult to rotate/update

### Fix Required

```text

## Remove hardcoded values

ENV CYNC_MQTT_USER="" \
 CYNC_MQTT_PASS="" \

# ... other vars

```text

These should be set at runtime via add-on configuration, NOT baked into the image.

**Effort:** 30 minutes

```text

---

## üî¥ SEC-2: SSL/TLS Verification Disabled

### File: `mitm/query_mode.py` (Lines 13-14)

#### Comment

```text

üî¥ **HIGH SECURITY ISSUE**: SSL Certificate Verification Disabled

This code disables SSL/TLS certificate verification, making it vulnerable to man-in-the-middle attacks.

### Risk:

- MITM attacks possible
- No protection against certificate tampering
- Insecure by design

### This is acceptable ONLY for local debugging.

### Fix Required:

1. Add prominent warning at top of file:

```text

"""
‚ö†Ô∏è SECURITY WARNING: DEBUG TOOL ONLY
This script disables SSL verification for MITM debugging.
DO NOT USE in production or with untrusted networks.
"""

```sql

2. Consider moving all MITM tools to separate repository:
   - `baudneo/cync-debugging-tools`
   - Clearly separate from production code
   - Reduce security risk surface

**Effort:** 2 hours (including repo restructure)

```text

---

### File: `mitm/send_via_mitm.py` (Lines 99-100)

#### Comment

```text

üî¥ **HIGH SECURITY ISSUE**: SSL Verification Disabled

Same issue as other MITM tools - SSL verification is disabled.

### Fix Required:

- Add security warnings
- Document debugging-only purpose
- Consider separate repository for debug tools

See comment on `mitm/query_mode.py` for full details.

**Effort:** 30 minutes

```text

---

### File: `mitm/mitm_with_injection.py` (Lines 493-494, 506-507)

#### Comment

```python

üî¥ **HIGH SECURITY ISSUE**: Multiple SSL Verification Bypasses

This MITM proxy disables SSL verification in multiple places:

- Line 493-494: Server context
- Line 506-507: Client context

### This is extremely dangerous if used outside of controlled debugging

### Fix Required

1. Add file-level warning:

```text

"""
‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è SECURITY WARNING ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è
This is a Man-in-the-Middle proxy for debugging Cync protocol.

- Disables ALL SSL security
- For LOCAL DEBUGGING ONLY
- DO NOT use on untrusted networks
- DO NOT use in production
  ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è
  """

```text

2. Move to separate debug repository
3. Add README warning in MITM directory

**Effort:** 1 hour

```text

---

## üî¥ SEC-3: Additional Security Concerns

### File: `mitm/mitm_with_injection.py` (Lines 72-75)

#### Comment

```python

üü° **MEDIUM SECURITY ISSUE**: Silent Exception Handling

Bare `except` clause silently swallows all errors, including security-relevant ones.

### Risk:

- Security errors hidden
- Attack attempts undetected
- Difficult debugging

### Fix Required:

```text

## Replace

try:
with open("mitm.log", "a") as f:
f.write(log_msg + "\n")
except Exception:
pass # ‚ùå Silent failure

## With

try:
with open("mitm.log", "a") as f:
f.write(log_msg + "\n")
except IOError as e:
print(f"WARNING: Log write failed: {e}", file=sys.stderr)
except Exception as e:
print(f"ERROR: Unexpected logging error: {e}", file=sys.stderr)

```javascript

**Effort:** 1 hour (across all files)

```text

---

### File: `cync-controller/static/index.html` (Line 142)

#### Comment

```javascript

üü° **MEDIUM ISSUE**: Deprecated Clipboard API

`document.execCommand('copy')` is deprecated and may not work in all browsers.

### Fix Required:

```text

// Replace deprecated API
async function copyConfig() {
const yamlText = document
.querySelector("#yamlPreview code")
.textContent.trim();

try {
// Modern Clipboard API
await navigator.clipboard.writeText(yamlText);
showToast("Config copied to clipboard!");
} catch (e) {
showError("Failed to copy: " + e.message);
}
}

```markdown
**Effort:** 30 minutes
**Browser Support:** Check for fallback on older browsers
```text

---

## Summary

**Total High-Severity Comments:** 7
**Critical Security Issues:** 4
**High Security Issues:** 3

### Priority Order for Review

1. **SEC-1 Comments** (credentials) - Review first, fix immediately
2. **SEC-2 Comments** (SSL) - Review second, document clearly
3. **SEC-3 Comments** (additional) - Review third, include in sprint

### Estimated Total Remediation Time

- Critical fixes: 4-6 hours
- Documentation/warnings: 2-3 hours
- Repository restructure: 2 days (optional but recommended)

### Total: ~1 week including restructure

```text

```text
