---
description: Automated Long-Lived Access Token (LLAT) flow
---

# Token Creation Flow

Three phases keep Home Assistant tokens valid:

1. **Onboarding token** (first run)
   - `setup-fresh-ha.sh` creates initial user â†’ returns short-lived token stored as `ONBOARDING_TOKEN` in `hass-credentials.env`.

2. **Bootstrap LLAT**
   - `get_ha_auth_token()` passes `ONBOARDING_TOKEN` to `scripts/create-token-from-existing.js`.
   - Script validates via REST + WebSocket and requests a long-lived token.

3. **Persist LLAT**
   - Long-lived token saved as `LONG_LIVED_ACCESS_TOKEN` in `hass-credentials.env`.
   - Onboarding token can be discarded after success.

**Rules:** never hardcode tokens, always pass through env vars, validate responses, and avoid creating redundant LLATs.

See `docs/developer/automated-token-creation.md` for full details.
