---
description: CRITICAL - Update todos before/after every task. Maintain mutual understanding with user.
---

# Plan and Todo Management

**CRITICAL: Don't complete todos without approval. When bugs are encountered, create a TODO and continue with the original task.**

**One plan per session** - Update the same plan file; don't create new ones.

## Tools

### create_plan

**CRITICAL: NEVER edit plan files with file tools. ALWAYS use create_plan. Todos are handled by the Cursor system, not markdown checkboxes.**

**First call:**
```python
create_plan(
    name="Short Name",    # Only on FIRST call
    overview="1-2 sentence summary",
    plan="# Title\n\nContent...",
    todos=[{"id": "task-1", "content": "Task", "status": "pending"}]
)
```

**Updating:**
- Full replacement: Provide new `plan` string
- Partial edit: Use `old_str`/`new_str` for specific sections
- Only todos: Pass `plan=""` (empty string), provide `todos` array with `status` field

### todo_write

**!!CRITICAL - NO EXCEPTIONS!!** Mandatory for multi-step (3+) tasks. Todos maintain mutual understanding of done/doing/to-do. Skipping updates breaks collaboration.

**Required Usage:**
```python
# ALWAYS mark in_progress BEFORE starting work
todo_write(merge=True, todos=[{"id": "x", "status": "in_progress"}])

# ALWAYS update AFTER finishing any task
todo_write(merge=True, todos=[{"id": "x", "status": "completed"}])

# ALWAYS update after ANY state change
todo_write(merge=True, todos=[{"id": "y", "status": "in_progress"}])
```

**State Transitions:**
1. `pending` → `in_progress` (BEFORE starting - communicate to user)
2. `in_progress` → `completed` (AFTER finishing - communicate to user)
3. Update after ANY todo state change (explain to user)

**Key Rules:**
- Apply to ALL multi-step (3+) tasks, not trivial edits
- ALWAYS explain updates to user ("✓ Completed X, starting Y...")
- Mark current task in_progress BEFORE starting
- Update after finishing ANY todo, before starting ANY todo
- Status values: "pending", "in_progress", "completed", "cancelled"

**Anti-Patterns (NEVER DO THIS):**
- ❌ Start work without marking todo in_progress
- ❌ Complete task without updating user
- ❌ Skip todo tracking on "simple" multi-step tasks
- ❌ Update todos silently without explaining to user
- ❌ Leave multiple todos in_progress simultaneously
