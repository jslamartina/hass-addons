---
description: 3-step development workflow (edit, rebuild, verify) with integrated quality gates
appliesTo:
  - "**/*.py"
  - "**/*.sh"
  - "cync-controller/**"
---

# Development Workflow

**CRITICAL:** Python edits require rebuild (not restart). See Executive Rule #1 in `_00-exec-rules.mdc`.

**CRITICAL:** For multi-step (3+) tasks, initialize todos and update status at each phase. See Executive Rule #7.

**Step 0: Todo Tracking** (multi-step tasks only)
- Initialize todos for all steps
- Mark current task `in_progress` BEFORE starting
- Update to `completed` AFTER finishing, communicate to user
- Explicit progress updates: "âœ“ Completed X, starting Y..."

**Standard 3-Step Process:**

1. **Edit** - Make your changes
2. **Rebuild/Restart** - Automatically runs linting, formatting, and unit tests (see table below)
3. **Verify** - `ha addons logs local_cync-controller --follow`

## Python vs Config Changes

**Why?** Python files are baked into Docker image at build time. Restarting alone won't load Python changes.

**NEVER start Docker manually** - Supervisor manages it. See `critical-docker.mdc` and Executive Rule #5.

**Note:** `rebuild.sh` now automatically runs linting, formatting, and unit tests before building the Docker image.

| Change Type                | Action      | Command                                   |
| -------------------------- | ----------- | ----------------------------------------- |
| Python files (`.py`)       | **REBUILD** | `cd cync-controller && ./rebuild.sh`      |
| `config.yaml`, `run.sh`    | Restart     | `ha addons restart local_cync-controller` |
| `static/*` (HTML, JS, CSS) | Restart     | `ha addons restart local_cync-controller` |
| When unsure                | **REBUILD** | `cd cync-controller && ./rebuild.sh`      |

## Manual Linting (Optional)

Run linting manually for spot checks without full rebuild:

```bash
# Python
npm run lint:python:fix && npm run format:python

# Shell scripts
npm run lint:shell

# Everything
npm run lint && npm run format
```

## MQTT Entity Management

When changing `suggested_area` or other discovery fields:

```bash
# Clean up stale entities
sudo python3 scripts/delete-mqtt-safe.py [--dry-run]
ha addons restart local_cync-controller
```

## Release Preparation

Before merging to `master`:

- Uncomment `image:` in `cync-controller/config.yaml`
